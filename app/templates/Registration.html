{% extends "base.html" %} {% block title %}التسجيل و العضوية - MCI{% endblock %}
{% block extra_styles %} .page-hero { position: relative; height: 40vh;
min-height: 300px; background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0,
0.5)), url('/static/Images/membership.jpg') no-repeat center center;
background-size: cover; display: flex; align-items: center; justify-content:
center; text-align: center; color: white; margin-bottom: 50px; } .page-hero h1 {
font-size: 3rem; font-weight: 700; text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
} .membership { padding: 70px 0; background-color: #f4f4f4; } .section-title {
text-align: center; margin-bottom: 50px; position: relative; } .section-title h2
{ font-size: 2.5rem; font-weight: 700; color: var(--primary-color);
margin-bottom: 15px; display: inline-block; position: relative; } .section-title
h2::after { content: ""; position: absolute; bottom: -10px; left: 50%;
transform: translateX(-50%); width: 80px; height: 3px; background-color:
var(--primary-color); } .pricing-container { display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;
direction: rtl; } .pricing-card { background-color: white; border-radius: 15px;
overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); transition: all
0.3s ease; position: relative; padding: 0; text-align: center; display: flex;
flex-direction: column; } .pricing-card:hover { transform: translateY(-10px);
box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); } .pricing-card.gold { border-top:
5px solid var(--gold-color); } .pricing-card.platinum { border-top: 5px solid
#e5e4e2; } .pricing-card .label { position: absolute; top: 10px; left: 10px;
padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; font-weight: bold; }
.pricing-card.gold .label { background-color: #ffd700; color: #333; }
.pricing-card.platinum .label { background-color: #e5e4e2; color: #333; }
.pricing-card .header { background-color: var(--primary-color); color: white;
padding: 20px; position: relative; overflow: hidden; } .pricing-card
.header::before { content: ""; position: absolute; top: -50%; right: -50%;
width: 200%; height: 200%; background: rgba(255, 255, 255, 0.1); transform:
rotate(45deg); z-index: 0; } .pricing-card .title { font-size: 1.5rem;
font-weight: 700; margin: 0; position: relative; z-index: 1; } .pricing-card
.icon { width: 80px; height: 80px; margin: 20px auto; display: flex;
align-items: center; justify-content: center; background-color: rgba(44, 95, 45,
0.1); border-radius: 50%; padding: 15px; } .pricing-card .icon img { max-width:
100%; max-height: 100%; } .pricing-card .price { margin: 15px 0; } .pricing-card
.amount { font-size: 2rem; font-weight: 700; color: var(--secondary-color); }
.pricing-card .period { display: block; font-size: 0.9rem; color: #777;
margin-top: 5px; } .pricing-card .features { padding: 20px; text-align: right;
flex-grow: 1; } .pricing-card ul { list-style-type: none; padding: 0; margin: 0;
} .pricing-card ul li { padding: 10px 30px 10px 0; border-bottom: 1px dashed
#eee; position: relative; } .pricing-card ul li:last-child { border-bottom:
none; } .pricing-card ul li::before { content: "✓"; position: absolute; right:
0; color: var(--primary-color); font-weight: bold; } .pricing-card .action {
padding: 20px; background-color: #f9f9f9; } .pricing-btn { display:
inline-block; padding: 12px 30px; background-color: var(--primary-color); color:
white; border-radius: 8px; text-decoration: none; font-weight: 600; transition:
all 0.3s ease; border: none; cursor: pointer; width: 100%; } .pricing-btn:hover
{ background-color: var(--secondary-color); transform: scale(1.05); } /* Modal
Styles */ .modal-content { border-radius: 15px; border: none; box-shadow: 0 10px
30px rgba(0, 0, 0, 0.1); direction: rtl; text-align: right; } .modal-header {
background-color: var(--primary-color); color: white; border-bottom: none;
border-top-left-radius: 15px; border-top-right-radius: 15px; padding: 20px 25px;
} .modal-title { font-weight: 600; font-size: 1.3rem; } .modal-header .btn-close
{ margin-left: 0; margin-right: auto; color: white; background-color: rgba(255,
255, 255, 0.3); opacity: 1; } .modal-body { padding: 25px; } .modal-footer {
padding: 15px 25px 25px; border-top: none; } .form-label { font-weight: 500;
color: #444; margin-bottom: 8px; } .form-control, .form-select { padding: 12px
15px; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; transition:
all 0.3s ease; } .form-control:focus, .form-select:focus { border-color:
var(--primary-color); box-shadow: 0 0 0 3px rgba(44, 95, 45, 0.1); }
.input-group { position: relative; } .input-icon { position: absolute; left:
15px; top: 50%; transform: translateY(-50%); color: #999; z-index: 10; }
.btn-secondary { background-color: #6c757d; border: none; padding: 10px 20px;
border-radius: 8px; font-weight: 500; transition: all 0.3s ease; }
.btn-secondary:hover { background-color: #5a6268; } .btn-primary {
background-color: var(--primary-color); border: none; padding: 10px 25px;
border-radius: 8px; font-weight: 500; transition: all 0.3s ease; }
.btn-primary:hover { background-color: var(--secondary-color); } .alert {
padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; animation: fadeIn
0.5s ease-in-out; } .alert-success { background-color: #d4edda; color: #155724;
border: 1px solid #c3e6cb; } .alert-error { background-color: #f8d7da; color:
#721c24; border: 1px solid #f5c6cb; } @keyframes fadeIn { from { opacity: 0;
transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
@media (max-width: 992px) { .pricing-container { grid-template-columns:
repeat(auto-fit, minmax(280px, 1fr)); } } @media (max-width: 768px) {
.pricing-container { grid-template-columns: 1fr; max-width: 400px; margin: 0
auto; } .page-hero h1 { font-size: 2.2rem; } .section-title h2 { font-size:
2rem; } } .benefit-icon { color: var(--primary-color); margin-left: 8px;
font-size: 1.2rem; vertical-align: middle; } /* Variables for gold and platinum
colors */ :root { --gold-color: #ffd700; --platinum-color: #e5e4e2; } {%
endblock %} {% block content %}
<!-- Page Hero -->
<section class="page-hero">
  <div class="container">
    <h1>التسجيل والعضوية</h1>
  </div>
</section>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %} {% if messages
%} {% for category, message in messages %}
<div class="alert alert-{{ category }}">{{ message }}</div>
{% endfor %} {% endif %} {% endwith %}

<!-- Membership Section -->
<section class="membership">
  <div class="container">
    <div class="section-title">
      <h2>اختر الباقة المناسبة لك</h2>
    </div>

    <div class="pricing-container">
      <!-- Free Plan -->
      <div class="pricing-card">
        <div class="header">
          <h3 class="title">الاشتراك المجاني</h3>
        </div>
        <div class="icon">
          <img src="/static/Images/FREE-mem.png" alt="Free Membership" />
        </div>
        <div class="price">
          <span class="amount">مجانا</span>
          <span class="period">للأفراد</span>
        </div>
        <div class="features">
          <ul>
            <li>عدد محدود من عمليات تدوير المخالفات شهريًا (3 مخالفات)</li>
            <li>دعم فني أساسي عبر البريد الإلكتروني</li>
            <li>إمكانية الترقية إلى اشتراك مدفوع</li>
            <li>التطوع معنا في المبادرات البيئية</li>
          </ul>
        </div>
        <div class="action">
          <button class="pricing-btn register-btn" data-membership-type="free">
            التسجيل الآن
          </button>
        </div>
      </div>

      <!-- Gold Plan -->
      <div class="pricing-card gold">
        <div class="label">الذهبي</div>
        <div class="header">
          <h3 class="title">الاشتراك الذهبي</h3>
        </div>
        <div class="icon">
          <img src="/static/Images/Gold-mem.png" alt="Gold Membership" />
        </div>
        <div class="price">
          <span class="amount">ج100</span>
          <span class="period">أشتراك شهري</span>
        </div>
        <div class="features">
          <ul>
            <li>عدد أكبر من عمليات تدوير المخالفات شهريًا (10 مخالفات)</li>
            <li>دعم فني أسرع (رد خلال 24 ساعة)</li>
            <li>تذكيرات شهرية بتفاصيل المخالفات والمدفوعات</li>
            <li>خصم 10% على خدمات الاستشارات القانونية المتعلقة بالمخالفات</li>
          </ul>
        </div>
        <div class="action">
          <button class="pricing-btn register-btn" data-membership-type="gold">
            التسجيل الآن
          </button>
        </div>
      </div>

      <!-- Platinum Plan -->
      <div class="pricing-card platinum">
        <div class="label">البلاتيني</div>
        <div class="header">
          <h3 class="title">الاشتراك البلاتيني</h3>
        </div>
        <div class="icon">
          <img
            src="/static/Images/platinum_mem.png"
            alt="Platinum Membership"
          />
        </div>
        <div class="price">
          <span class="amount">ج300</span>
          <span class="period">كل 3 أشهر</span>
        </div>
        <div class="features">
          <ul>
            <li>عدد غير محدود من عمليات تدوير المخالفات</li>
            <li>وصول مميز إلى أدوات تحليل المخالفات</li>
            <li>دعم فني على مدار الساعة</li>
            <li>خصم 20% على الاستشارات القانونية أو خدمات إدارة المركبات</li>
          </ul>
        </div>
        <div class="action">
          <button
            class="pricing-btn register-btn"
            data-membership-type="platinum"
          >
            التسجيل الآن
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Registration Modal -->
<div class="modal fade" id="registrationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">التسجيل في الخدمة</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form id="registrationForm">
          <input type="hidden" id="membershipType" name="membership_type" />

          <div class="mb-3">
            <label for="fullName" class="form-label">الاسم بالكامل</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                id="fullName"
                name="full_name"
                required
              />
              <span class="input-icon"><i class="fas fa-user"></i></span>
            </div>
          </div>

          <div class="mb-3">
            <label for="email" class="form-label">البريد الإلكتروني</label>
            <div class="input-group">
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                required
              />
              <span class="input-icon"><i class="fas fa-envelope"></i></span>
            </div>
          </div>

          <div class="mb-3">
            <label for="phone" class="form-label">رقم الهاتف</label>
            <div class="input-group">
              <input
                type="tel"
                class="form-control"
                id="phone"
                name="phone"
                required
              />
              <span class="input-icon"><i class="fas fa-phone"></i></span>
            </div>
          </div>

          <div class="mb-3">
            <label for="address" class="form-label">العنوان</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                id="address"
                name="address"
                required
              />
              <span class="input-icon"
                ><i class="fas fa-map-marker-alt"></i
              ></span>
            </div>
          </div>

          <div class="mb-3">
            <label for="paymentMethod" class="form-label">طريقة الدفع</label>
            <select
              class="form-select"
              id="paymentMethod"
              name="payment_method"
              required
            >
              <option value="" disabled selected>اختر طريقة الدفع</option>
              <option value="credit_card">بطاقة ائتمان</option>
              <option value="bank_transfer">تحويل بنكي</option>
              <option value="vodafone_cash">فودافون كاش</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          إلغاء
        </button>
        <button type="button" class="btn btn-primary" id="submitRegistration">
          تأكيد التسجيل
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %} // Replace the existing script block with
this updated version

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize modal
    const registrationModal = new bootstrap.Modal(
      document.getElementById("registrationModal")
    );

    // Handle registration buttons
    document.querySelectorAll(".register-btn").forEach((button) => {
      button.addEventListener("click", function () {
        const membershipType = this.getAttribute("data-membership-type");
        document.getElementById("membershipType").value = membershipType;

        // Update modal title based on membership type
        const modalTitle = document.querySelector(".modal-title");
        if (membershipType === "free") {
          modalTitle.textContent = "التسجيل في الباقة المجانية";
        } else if (membershipType === "gold") {
          modalTitle.textContent = "التسجيل في الباقة الذهبية";
        } else if (membershipType === "platinum") {
          modalTitle.textContent = "التسجيل في الباقة البلاتينية";
        }

        // Show payment method only for paid plans
        const paymentMethodField = document
          .querySelector("#paymentMethod")
          .closest(".mb-3");
        if (membershipType === "free") {
          paymentMethodField.style.display = "none";
          document.getElementById("paymentMethod").removeAttribute("required");
        } else {
          paymentMethodField.style.display = "block";
          document
            .getElementById("paymentMethod")
            .setAttribute("required", "required");
        }

        registrationModal.show();
      });
    });

    // Form validation and submission
    document
      .getElementById("submitRegistration")
      .addEventListener("click", function () {
        const form = document.getElementById("registrationForm");

        // Basic form validation
        const requiredFields = form.querySelectorAll("[required]");
        let isValid = true;

        requiredFields.forEach((field) => {
          if (!field.value.trim()) {
            field.classList.add("is-invalid");
            isValid = false;
          } else {
            field.classList.remove("is-invalid");
          }
        });

        // Email validation
        const email = document.getElementById("email");
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (email.value && !emailRegex.test(email.value)) {
          email.classList.add("is-invalid");
          isValid = false;
        }

        // Phone validation (basic)
        const phone = document.getElementById("phone");
        if (
          phone.value &&
          !/^\d{8,15}$/.test(phone.value.replace(/[\s-]/g, ""))
        ) {
          phone.classList.add("is-invalid");
          isValid = false;
        }

        if (!isValid) {
          // Show error message
          alert("يرجى التأكد من صحة جميع البيانات المدخلة");
          return;
        }

        // Show loading state
        const submitBtn = document.getElementById("submitRegistration");
        const originalBtnText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.innerHTML =
          '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> جاري التسجيل...';

        // Get form data
        const formData = new FormData(form);

        // Send data to server
        fetch("/api/register", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Show success message
              alert(data.message);

              // Close modal and reset form
              registrationModal.hide();
              form.reset();

              // Redirect to registration page with success message
              window.location.href =
                "/Registration.html?status=success&message=" +
                encodeURIComponent("تم التسجيل بنجاح! سيتم التواصل معك قريباً");
            } else {
              // Show error message
              alert(data.message || "حدث خطأ أثناء التسجيل");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("حدث خطأ أثناء إرسال البيانات");
          })
          .finally(() => {
            // Restore button state
            submitBtn.disabled = false;
            submitBtn.textContent = originalBtnText;
          });
      });

    // Fields validation on input
    document
      .querySelectorAll(".form-control, .form-select")
      .forEach((field) => {
        field.addEventListener("input", function () {
          if (this.value.trim()) {
            this.classList.remove("is-invalid");
          }
        });
      });

    // Animation for pricing cards
    document.querySelectorAll(".pricing-card").forEach((card, index) => {
      setTimeout(() => {
        card.style.opacity = "1";
        card.style.transform = "translateY(0)";
      }, 100 * (index + 1));
    });

    // Check for URL parameters on page load
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("status") === "success") {
      const message = urlParams.get("message") || "تم التسجيل بنجاح!";
      const alertDiv = document.createElement("div");
      alertDiv.className = "alert alert-success alert-dismissible fade show";
      alertDiv.role = "alert";
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      `;

      document.querySelector(".container").prepend(alertDiv);

      // Auto-dismiss after 5 seconds
      setTimeout(() => {
        const bsAlert = new bootstrap.Alert(alertDiv);
        bsAlert.close();
      }, 5000);
    }
  });
</script>
<style>
  .pricing-card {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .form-control.is-invalid,
  .form-select.is-invalid {
    border-color: #dc3545;
    background-image: none;
  }
</style>
{% endblock %}
